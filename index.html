<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Music Player</title>

<style>
  body { 
    font-family: Arial; background:#111; color:white; 
    padding:20px; text-align:center;
  }
  .player {
    max-width:400px; margin:auto; background:#222; 
    padding:20px; border-radius:10px;
  }
  ul { list-style:none; padding:0; }
  li {
    background:#333; margin:5px 0; padding:10px;
    border-radius:6px; cursor:pointer;
  }
  li:hover { background:#444; }
</style>
</head>
<body>

<h2>My Favorit Music</h2>

<div class="player">
  <audio id="audio" controls style="width:100%; margin-bottom:15px;"></audio>

  <h3>Playlist</h3>
  <ul id="playlist"></ul>
</div>

<script>
  const songs = [
    { title: "Flatline", url: "https://raw.githubusercontent.com/rikorandika910/wkw/main/Flatline.mp3" },
    { title: "Nuts", url: "https://raw.githubusercontent.com/rikorandika910/wkw/main/Nuts.mp3" },
    { title: "Hold Me Down", url: "https://raw.githubusercontent.com/rikorandika910/wkw/main/Hold Me Down.mp3" }
  ];

  const audio = document.getElementById("audio");
  const playlist = document.getElementById("playlist");

  let currentIndex = 0;

  function loadSong(index) {
    currentIndex = index;
    audio.src = songs[index].url;
  }

  function playSong(index) {
    loadSong(index);
    audio.play().catch(err => console.log("Autoplay blocked:", err));
  }

  // Generate playlist
  songs.forEach((song, index) => {
    const li = document.createElement("li");
    li.textContent = song.title;
    li.addEventListener("click", () => playSong(index));
    playlist.appendChild(li);
  });

  // Set lagu pertama
  loadSong(0);

  // === AUTO NEXT FIX ===
  audio.addEventListener("ended", () => {
    let next = currentIndex + 1;
    if (next >= songs.length) next = 0;

    loadSong(next);

    // Pemutarannya HARUS dilakukan setelah onended,
    // dengan gesture sebelumnya dianggap valid.
    setTimeout(() => {
      audio.play().catch(err => console.warn("Autoplay prevented:", err));
    }, 200);
  });
</script>
